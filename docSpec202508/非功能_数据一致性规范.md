


报表统计使用实时聚合，不要使用增量更新模式
分布式事务机制  自定义实现分布式事务引擎发表api调用事务
cache缓存：原则上不使用减少数据错误，少数情况根据实际适当使用
报表统计，原则上使用实时统计聚合查询。尽可能不使用增量更新模式容易数据错误
聚合统计	始终使用全量聚合查询；避免写时增量更新计数，防止并发数据错乱
分布式事务	引入 TCC、SAGA、或本地事务 + 异步补偿机制
幂等处理	每笔交易、回调都需幂等设计，保证重复请求不会修改结果状态
强一致性关键点	资金变动、账务入账等关键操作采用强一致机制，例如锁或队列串行
消息队列	保证顺序投递（如 Kafka partition key）+ 消息持久化
数据回写补偿	异常场景如写入失败，需具备数据补偿方案


外键机制
数据约束


时间窗事务控制	限定操作必须在某个时段完成，例如“支付必须在创建后5分钟内完成”，避免状态错乱
✅ 版本号/状态码控制	状态变更流程加版本或状态字段，每一步只能由特定前置状态切换，防止跳跃或冲突
✅ 分布式锁（如 Redisson）	控制对某资源的操作串行化，避免并发导致的数据覆盖、资金错误
✅ 数据库唯一约束 + 索引	强制唯一交易号、订单号，防止重复插入；结合业务幂等ID做物理保障
✅ 重试机制具备幂等防护	异步组件重试（如 MQ 消费失败后重试）需检测是否已处理，避免重复动作
✅ 最终一致性反馈机制	某些流程允许延迟，但必须设计“完成确认”回写机制，如支付成功通知需落地账务状态
✅ 链路状态回溯与诊断	每步操作记录日志或链路标识，辅助分析一致性问题来源
✅ 定期数据快照比对	每日自动生成数据快照，定时比对资金账/余额/订单状态是否一致，用于风控与运维
✅ 存储级别事务保障（PostgreSQL、SQL Server）	避免底层事务设置失误引发回滚失败或未提交的问题



